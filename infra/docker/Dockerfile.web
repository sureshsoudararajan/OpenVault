# ---- Build Stage ----
FROM node:20-alpine AS builder

WORKDIR /app

COPY package.json package-lock.json* ./
COPY tsconfig.base.json ./
COPY packages/ ./packages/
COPY apps/web/ ./apps/web/

RUN npm install --workspace=apps/web --include-workspace-root
RUN npm run build --workspace=apps/web

# ---- Production Stage ----
FROM node:20-alpine AS production

WORKDIR /app

RUN npm install -g serve

COPY --from=builder /app/apps/web/dist/ ./dist/

EXPOSE 3000

CMD ["serve", "-s", "dist", "-l", "3000"]
